<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.com.asapro.capability.service.CapabilityMapper">
	
	<resultMap type="Capability" id="capabilityPlainResultMap">
		<id column="CAP_ID" property="capId" javaType="String"/>
		<result column="CAP_NAME" property="capName" javaType="String"/>
		<result column="CAP_DESCRIPTION" property="capDescription" javaType="String"/>
		<result column="CAP_VALUE" property="capValue" javaType="String"/>
		<result column="CAP_PARAM1_KEY" property="capParam1Key" javaType="String"/>
		<result column="CAP_PARAM1_VALUE" property="capParam1Value" javaType="String"/>
		<result column="CAP_PARAM2_KEY" property="capParam2Key" javaType="String"/>
		<result column="CAP_PARAM2_VALUE" property="capParam2Value" javaType="String"/>
		<result column="CAP_HTTP_METHOD" property="capHttpMethod" javaType="String"/>
		<result column="CAP_REGDATE" property="capRegDate" javaType="Date"/>
		<result column="CAP_DEFAULT" property="capDefault" javaType="Boolean"/>
		<result column="CAP_PRIORITY" property="capPriority" javaType="Integer"/>
		<result column="CAP_HIDDEN" property="capHidden" javaType="Boolean"/>
	</resultMap>
	
	<sql id="capabilityPlainColumns">
		CAP_ID
		, CAP_NAME
		, CAP_DESCRIPTION
		, CAP_VALUE
		, CAP_PARAM1_KEY
		, CAP_PARAM1_VALUE
		, CAP_PARAM2_KEY
		, CAP_PARAM2_VALUE
		, CAP_HTTP_METHOD
		, CAP_REGDATE
		, CAP_DEFAULT
		, CAP_PRIORITY
		, CAP_HIDDEN
	</sql>
	
	<sql id="capabilityJoinColumns">
		CAP.CAP_ID
		, CAP.CAP_NAME
		, CAP.CAP_DESCRIPTION
		, CAP.CAP_VALUE
		, CAP.CAP_PARAM1_KEY
		, CAP.CAP_PARAM1_VALUE
		, CAP.CAP_PARAM2_KEY
		, CAP.CAP_PARAM2_VALUE
		, CAP.CAP_HTTP_METHOD
		, CAP.CAP_REGDATE
		, CAP.CAP_DEFAULT
		, CAP.CAP_PRIORITY
		, CAP.CAP_HIDDEN
	</sql>
	
	<select id="selectCapabilityList" parameterType="CapabilitySearch" resultMap="capabilityPlainResultMap">
		SELECT
			<include refid="capabilityPlainColumns"/>
		FROM ASA_CAPABILITY
		<where>
			<if test="sv != null and sv != ''">
				<if test="sc == null or sc == ''">
					AND (
						CAP_NAME LIKE CONCAT('%',#{sv},'%')
						OR CAP_DESCRIPTION LIKE CONCAT('%',#{sv},'%')
					)
				</if>
				<if test="sc != null and sc != ''">
					AND ${sc} LIKE CONCAT('%',#{sv},'%')
				</if>
			</if>
			
			AND CAP_HIDDEN = 0
		</where>
		<if test="sortOrder != null and sortOrder != '' and sortDirection != null and sortDirection != ''">
			ORDER BY ${sortOrder} ${sortDirection}
		</if>
		<if test="sortOrder == null or sortOrder == '' or sortDirection == null or sortDirection == ''">
			ORDER BY CAP_DEFAULT DESC, CAP_PRIORITY ASC, CAP_NAME ASC, CAP_REGDATE DESC
		</if>
		<if test="paging">
		LIMIT ${pageSize} OFFSET #{offset}
		</if>
	</select>
	
	<select id="selectCapabilityListTotal" parameterType="CapabilitySearch" resultType="Integer">
		SELECT
			COUNT(*)
		FROM ASA_CAPABILITY
		<where>
			<if test="sv != null and sv != ''">
				<if test="sc == null or sc == ''">
					AND (
						CAP_NAME LIKE CONCAT('%',#{sv},'%')
						OR CAP_DESCRIPTION LIKE CONCAT('%',#{sv},'%')
					)
				</if>
				<if test="sc != null and sc != ''">
					AND ${sc} LIKE CONCAT('%',#{sv},'%')
				</if>
			</if>
			
			AND CAP_HIDDEN = 0
		</where>
	</select>
	
	<select id="selectCapability" parameterType="Capability" resultMap="capabilityPlainResultMap">
		SELECT 
			<include refid="capabilityPlainColumns"/>
		FROM ASA_CAPABILITY
		<where>
			CAP_ID = #{capId}
		</where>
	</select>
	
	<insert id="insertCapability" parameterType="Capability">
		INSERT INTO ASA_CAPABILITY (
			<include refid="capabilityPlainColumns"/>
		) VALUES (
			#{capId}
			, #{capName}
			, #{capDescription}
			, #{capValue}
			, #{capParam1Key}
			, #{capParam1Value}
			, #{capParam2Key}
			, #{capParam2Value}
			, #{capHttpMethod}
			, #{capRegDate}
			, #{capDefault}
			, #{capPriority}
			, #{capHidden}
		)
	</insert>
			
	<update id="updateCapability" parameterType="Capability">
		UPDATE ASA_CAPABILITY SET
			CAP_NAME			=	#{capName}
			, CAP_DESCRIPTION	=	#{capDescription}
			, CAP_VALUE			=	#{capValue}
			, CAP_PARAM1_KEY	=	#{capParam1Key}
			, CAP_PARAM1_VALUE	=	#{capParam1Value}
			, CAP_PARAM2_KEY	=	#{capParam2Key}
			, CAP_PARAM2_VALUE	=	#{capParam2Value}
			, CAP_HTTP_METHOD	=	#{capHttpMethod}
			, CAP_DEFAULT		=	#{capDefault}
			, CAP_PRIORITY		=	#{capPriority}
		<where>
			CAP_ID = #{capId}
		</where>
	</update>
	
	<delete id="deleteCapability" parameterType="Capability">
		DELETE FROM ASA_CAPABILITY 
		<where>
			CAP_ID = #{capId}
			AND CAP_DEFAULT != 1
		</where>
	</delete>
		
	<select id="selectRoleCapabilityListByCap" parameterType="CapabilitySearch" resultMap="capabilityPlainResultMap">
		SELECT 
			<include refid="capabilityJoinColumns"></include>
		FROM ASA_ROLE ROL
		INNER JOIN ASA_ROLE_CAP RC
		ON ROL.ROLE_CODE = RC.ROLE_CODE
		INNER JOIN ASA_CAPABILITY CAP
		ON RC.CAP_ID = CAP.CAP_ID
		<where>
			ROL.ROLE_CODE = #{roleCode}
			AND CAP.CAP_HIDDEN = 0
		</where>
		ORDER BY CAP.CAP_PRIORITY DESC, CAP.CAP_NAME ASC
	</select>
	
</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.com.asapro.openapiinfo.service.OpenApiInfoMapper">
	
	<resultMap type="OpenApiInfo" id="openApiInfoPlainResultMap">
		<id column="API_SEQ" property="apiSeq" javaType="Integer" />
		<result column="API_ID" property="apiId" javaType="String" />	
		<result column="API_TITLE" property="apiTitle" javaType="String" />
		<result column="API_CONTENT" property="apiContent" javaType="String" />
		<result column="API_REGDATE" property="apiRegDate" javaType="Date" />
		<result column="API_PROVIDER" property="apiProvider" javaType="String" />	
		<result column="API_DOMAIN" property="apiDomain" javaType="String" />
		<result column="API_KEY" property="apiKey" javaType="String" />
		<result column="API_RETURN_TYPE" property="apiReturnType" javaType="String" />
		<result column="API_NUM_OF_ROW" property="apiNumOfRow" javaType="Integer" />
		<result column="API_TABLE_NAME" property="apiTableName" javaType="String" />
		<result column="API_LAST_BATCH" property="apiLastBatch" javaType="Date" />
		<result column="API_INPUT_TYPE" property="apiInputType" javaType="String" />
	</resultMap>
	
	
	<sql id="openApiInfoPlainColumns">
		API_SEQ
		, API_ID
		, API_TITLE
		, API_CONTENT
		, API_REGDATE
		, API_PROVIDER
		, API_DOMAIN
		, API_KEY
		, API_RETURN_TYPE
		, API_NUM_OF_ROW
		, API_TABLE_NAME
		, API_LAST_BATCH
		, API_INPUT_TYPE
	</sql>
	
	<sql id="openApiInfoJoinColumns">
		API.API_SEQ
		, API.API_ID
		, API.API_TITLE
		, API.API_CONTENT
		, API.API_REGDATE
		, API.API_PROVIDER
		, API.API_DOMAIN
		, API.API_KEY
		, API.API_RETURN_TYPE
		, API.API_NUM_OF_ROW
		, API.API_TABLE_NAME
		, API.API_LAST_BATCH
		, API.API_INPUT_TYPE
	</sql>
	
	
	<select id="selectOpenApiInfoList" parameterType="OpenApiInfoSearch" resultMap="openApiInfoPlainResultMap">
		<if test="paging">
		SELECT * FROM(
			SELECT ROWNUM RN, Z.* FROM(
		</if>
			SELECT 
				<include refid="openApiInfoPlainColumns"/>
			FROM ASA_API_INFO API
			<where>
				<if test="sv != null and sv != ''">
					<if test="sc == null or sc == ''">
						AND (
							API_TITLE LIKE '%'||#{sv}||'%'
							OR API_CONTENT LIKE '%'||#{sv}||'%'
						)
					</if>
					<if test="sc != null and sc != ''">
						AND ${sc} LIKE '%'||#{sv}||'%'
					</if>
				</if>
			</where>
			<if test="sortOrder != null and sortOrder != '' and sortDirection != null and sortDirection != ''">
				ORDER BY ${sortOrder} ${sortDirection}
			</if>
			<if test="sortOrder == null or sortOrder == '' or sortDirection == null or sortDirection == ''">
				ORDER BY API_SEQ DESC
			</if> 
		<if test="paging">
			) Z
		)
		<where>
			RN BETWEEN #{startRow} AND #{endRow}
		</where>
		</if> 
	</select>
	
	<select id="selectOpenApiInfoListTotal" parameterType="OpenApiInfoSearch" resultType="Integer">
		SELECT 
			COUNT(*)
		FROM ASA_API_INFO API
		<where>
			<if test="sv != null and sv != ''">
				<if test="sc == null or sc == ''">
					AND (
						API_TITLE LIKE '%'||#{sv}||'%'
						OR API_CONTENT LIKE '%'||#{sv}||'%'
					)
				</if>
				<if test="sc != null and sc != ''">
					AND ${sc} LIKE '%'||#{sv}||'%'
				</if>
			</if>
		</where>
	</select>
	
	<insert id="insertOpenApiInfo" parameterType="OpenApiInfo">
		<selectKey keyProperty="apiSeq" order="BEFORE" resultType="Integer">
			SELECT ASA_COMMON_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO ASA_API_INFO (
			<include refid="openApiInfoPlainColumns"/>
		) VALUES (
			#{apiSeq}
			, #{apiId}
			, #{apiTitle}
			, #{apiContent}
			, #{apiRegDate}
			, #{apiProvider}
			, #{apiDomain}
			, #{apiKey}
			, #{apiReturnType}
			, #{apiNumOfRow}
			, #{apiTableName}
			, #{apiLastBatch}
			, #{apiInputType}
		)
	</insert>
	
	<select id="selectOpenApiInfo" parameterType="OpenApiInfo" resultMap="openApiInfoPlainResultMap">
		SELECT 
			<include refid="openApiInfoPlainColumns"/>
		FROM ASA_API_INFO
		<where>
			API_SEQ = #{apiSeq}
		</where>
	</select>
	
	<update id="updateOpenApiInfo" parameterType="OpenApiInfo">
		UPDATE ASA_API_INFO SET
			API_ID						=	#{apiId}
			, API_TITLE					=	#{apiTitle}
			, API_CONTENT				=	#{apiContent}
			, API_PROVIDER				=	#{apiProvider}
			, API_DOMAIN				=	#{apiDomain}
			, API_KEY					=	#{apiKey}
			, API_RETURN_TYPE			=	#{apiReturnType}
			, API_NUM_OF_ROW			=	#{apiNumOfRow}
			, API_TABLE_NAME			=	#{apiTableName}
		<where>	
			API_SEQ = #{apiSeq}
		</where>
	</update>
	
	<delete id="deleteOpenApiInfo" parameterType="OpenApiInfo">
		DELETE FROM ASA_API_INFO
		<where>
			API_SEQ = #{apiSeq}
		</where>
	</delete>
	
	<update id="updateBatchInfo" parameterType="OpenApiInfo">
		UPDATE ASA_API_INFO SET
			API_LAST_BATCH			=	#{apiLastBatch}
			, API_INPUT_TYPE		=	#{apiInputType}
		<where>	
			API_SEQ = #{apiSeq}
		</where>
	</update>
	
</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.com.asapro.archive.customtype.space.service.SpaceMapper">
	
	<resultMap type="Space" id="spacePlainResultMap" extends="egovframework.com.asapro.archive.service.ArchiveMapper.archivePlainResultMap">
		<result column="SPA_LOCATION" property="spaLocation" javaType="String" />
		<result column="SPA_TEL" property="spaTel" javaType="String" />	
		<result column="SPA_USE_HOURS" property="spaUseHours" javaType="String" />
		<result column="SPA_BUSINESS_HOURS" property="spaBusinessHours" javaType="String" />
		<result column="SPA_AGENCY" property="spaAgency" javaType="String" />	
		<result column="SPA_SITE_URL" property="spaSiteUrl" javaType="String" />
	</resultMap>
	
	<resultMap type="Space" id="spaceComplexResultMap" extends="egovframework.com.asapro.archive.service.ArchiveMapper.archiveComplexResultMap">
		<result column="SPA_LOCATION" property="spaLocation" javaType="String" />
		<result column="SPA_TEL" property="spaTel" javaType="String" />	
		<result column="SPA_USE_HOURS" property="spaUseHours" javaType="String" />
		<result column="SPA_BUSINESS_HOURS" property="spaBusinessHours" javaType="String" />
		<result column="SPA_AGENCY" property="spaAgency" javaType="String" />	
		<result column="SPA_SITE_URL" property="spaSiteUrl" javaType="String" />
	</resultMap>


	<sql id="spacePlainColumns">
		ARC_ID
		, SPA_LOCATION
		, SPA_TEL
		, SPA_USE_HOURS
		, SPA_BUSINESS_HOURS
		, SPA_AGENCY
		, SPA_SITE_URL
	</sql>
			
	<sql id="spaceJoinColumns">
		SPA.ARC_ID AS SPA_ARC_ID
		, SPA.SPA_LOCATION
		, SPA.SPA_TEL
		, SPA.SPA_USE_HOURS
		, SPA.SPA_BUSINESS_HOURS
		, SPA.SPA_AGENCY
		, SPA.SPA_SITE_URL
	</sql>
	
	
	<!-- ====================================================================================================== -->
	<!-- ==========================================		공간정보	 ================================================= -->
	<!-- ====================================================================================================== -->
	
	<select id="selectSpaceList" parameterType="SpaceSearch" resultMap="spaceComplexResultMap">
		SELECT
			<include refid="egovframework.com.asapro.archive.service.ArchiveMapper.archiveJoinColumns"/>
			,<include refid="spaceJoinColumns" />
			, #{sitePrefix} AS SITE_PREFIX
			, <include refid="egovframework.com.asapro.fileinfo.service.FileInfoMapper.fileInfoJoinColumns" />
  			, <include refid="egovframework.com.asapro.member.admin.service.AdminMemberMapper.adminMemberJoinColumns" />
		FROM 
		${sitePrefix}_ARCHIVE ARC
		RIGHT OUTER JOIN ${sitePrefix}_SPACE SPA ON ARC.ARC_ID = SPA.ARC_ID
		LEFT OUTER JOIN ASA_ADMIN_MEMBER ADM ON ARC.MEM_ID = ADM.ADMIN_ID
		LEFT OUTER JOIN ${sitePrefix}_FILEINFO FI ON ARC.ARC_THUMB = FI.FILE_ID
		<where>
			ARC.ARC_CUSTOM_TYPE = 'space'
			<if test="sv != null and sv != ''">
				<if test="sc == null or sc == ''">
					AND (
						ARC_TITLE LIKE CONCAT('%',#{sv},'%')
						OR ARC_CONTENT LIKE CONCAT('%',#{sv},'%')
					)
				</if>
				<if test="sc != null and sc != ''">
					AND ${sc} LIKE CONCAT('%',#{sv},'%')
				</if>
			</if>
			<if test="arcCategory != null and arcCategory != ''">
				AND ARC.ARC_CATEGORY = #{arcCategory}
			</if>
			<if test="metaCode1 != null and metaCode1 != ''">
				AND ARC.ARC_META_CODE1 = #{metaCode1}
			</if>
			<if test="metaCode2 != null and metaCode2 != ''">
				AND ARC.ARC_META_CODE2 = #{metaCode2}
			</if>
			<if test="metaCode3 != null and metaCode3 != ''">
				AND ARC.ARC_META_CODE3 = #{metaCode3}
			</if>
			<if test="arcUse != null">
				AND ARC.ARC_USE = #{arcUse}
			</if>
			<if test="arcSelected1 != null">
				AND ARC.ARC_SELECTED1 = #{arcSelected1}
			</if>
			
			
		</where>
		<if test="sortOrder != null and sortOrder != '' and sortDirection != null and sortDirection != ''">
			ORDER BY ${sortOrder} ${sortDirection}
		</if>
		<if test="sortOrder == null or sortOrder == '' or sortDirection == null or sortDirection == ''">
			ORDER BY ARC.ARC_ID DESC
		</if>
		<if test="paging">
		LIMIT ${pageSize} OFFSET #{offset}
		</if>
	</select>
	
	<select id="selectSpaceListTotal" parameterType="SpaceSearch" resultType="Integer">
		SELECT 
			COUNT(*)
		FROM ${sitePrefix}_ARCHIVE ARC
		RIGHT OUTER JOIN ${sitePrefix}_SPACE SPA ON ARC.ARC_ID = SPA.ARC_ID
		LEFT OUTER JOIN ASA_ADMIN_MEMBER ADM ON ARC.MEM_ID = ADM.ADMIN_ID
		LEFT OUTER JOIN ${sitePrefix}_FILEINFO FI ON ARC.ARC_THUMB = FI.FILE_ID
		<where>
			ARC.ARC_CUSTOM_TYPE = 'space'
			<if test="sv != null and sv != ''">
				<if test="sc == null or sc == ''">
					AND (
						ARC_TITLE LIKE CONCAT('%',#{sv},'%')
						OR ARC_CONTENT LIKE CONCAT('%',#{sv},'%')
					)
				</if>
				<if test="sc != null and sc != ''">
					AND ${sc} LIKE CONCAT('%',#{sv},'%')
				</if>
			</if>
			<if test="arcCategory != null and arcCategory != ''">
				AND ARC.ARC_CATEGORY = #{arcCategory}
			</if>
			<if test="metaCode1 != null and metaCode1 != ''">
				AND ARC.ARC_META_CODE1 = #{metaCode1}
			</if>
			<if test="metaCode2 != null and metaCode2 != ''">
				AND ARC.ARC_META_CODE2 = #{metaCode2}
			</if>
			<if test="metaCode3 != null and metaCode3 != ''">
				AND ARC.ARC_META_CODE3 = #{metaCode3}
			</if>
			<if test="arcUse != null">
				AND ARC.ARC_USE = #{arcUse}
			</if>
			<if test="arcSelected1 != null">
				AND ARC.ARC_SELECTED1 = #{arcSelected1}
			</if>
		</where>
	</select>
	
	<insert id="insertSpace" parameterType="Space">
		INSERT INTO ${sitePrefix}_SPACE (
			<include refid="spacePlainColumns"/>
		) VALUES (
			#{arcId}
			, #{spaLocation}
			, #{spaTel}
			, #{spaUseHours}
			, #{spaBusinessHours}
			, #{spaAgency}
			, #{spaSiteUrl}
		)
	</insert>
	
	<select id="selectSpace" parameterType="Space" resultMap="spaceComplexResultMap">
		SELECT
			<include refid="egovframework.com.asapro.archive.service.ArchiveMapper.archiveJoinColumns"/>
			,<include refid="spaceJoinColumns" />
			, #{sitePrefix} AS SITE_PREFIX
			, <include refid="egovframework.com.asapro.fileinfo.service.FileInfoMapper.fileInfoJoinColumns" />
  			, <include refid="egovframework.com.asapro.member.admin.service.AdminMemberMapper.adminMemberJoinColumns" />
		FROM 
			${sitePrefix}_ARCHIVE ARC
			RIGHT OUTER JOIN ${sitePrefix}_SPACE SPA ON ARC.ARC_ID = SPA.ARC_ID
			LEFT OUTER JOIN ASA_ADMIN_MEMBER ADM ON ARC.MEM_ID = ADM.ADMIN_ID
			LEFT OUTER JOIN ${sitePrefix}_FILEINFO FI ON ARC.ARC_THUMB = FI.FILE_ID
		<where>
			ARC.ARC_ID = #{arcId}
		</where>
	</select>
	
	<update id="updateSpace" parameterType="Space">
		UPDATE ${sitePrefix}_SPACE SET
			SPA_LOCATION					=	#{spaLocation}
			, SPA_TEL						=	#{spaTel}
			, SPA_USE_HOURS					=	#{spaUseHours}
			, SPA_BUSINESS_HOURS			=	#{spaBusinessHours}
			, SPA_AGENCY					=	#{spaAgency}
			, SPA_SITE_URL					=	#{spaSiteUrl}
		<where>
			ARC_ID	=	#{arcId}
		</where>
	</update>
	
</mapper>